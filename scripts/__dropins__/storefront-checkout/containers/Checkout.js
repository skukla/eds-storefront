import{i as J,P as Q}from"../chunks/countries.js";import{e as p,U as W}from"../chunks/dispatchApiCall.js";import{events as T}from"@dropins/tools/event-bus.js";import{p as X,g as Y,a as D}from"../chunks/placeOrder2.js";import{i as ee}from"../chunks/IsBillToShippingSignal.js";import{C as f}from"../chunks/CartSummaryItem.js";import{useEffect as te}from"@dropins/tools/preact-hooks.js";import{classes as m,Slot as d}from"@dropins/tools/lib.js";import{IllustratedMessage as v,Icon as E,Button as C}from"@dropins/tools/components.js";/* empty css                             */import{jsx as t,jsxs as L}from"@dropins/tools/preact-jsx-runtime.js";import*as r from"@dropins/tools/preact-compat.js";import{useState as k,useCallback as re,useEffect as oe}from"@dropins/tools/preact-compat.js";import{useText as g,Text as ne,MarkupText as ie}from"@dropins/tools/i18n.js";import{S as se}from"../chunks/ShippingMethods.js";import{L as ce}from"../chunks/LoginForm.js";import{S as ae}from"../chunks/ShippingForm.js";import{B as le}from"../chunks/BillToShippingAddress2.js";import{O as me}from"../chunks/OrderSummary.js";import{P as ue}from"../chunks/PaymentMethods.js";import{B as de}from"../chunks/BillingForm.js";import{P as pe}from"../chunks/PlaceOrder.js";import{E as he}from"../chunks/ErrorBanner.js";import{C as fe}from"../chunks/CartSummary.js";import"@dropins/tools/preact.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getCheckoutData.graphql.js";import"../chunks/cart-item.js";import"../chunks/estimateShippingMethods.js";import"../chunks/SelectedShippingMethodSignal.js";import"../chunks/setShippingMethods.js";import"../chunks/setGuestEmailOnCart.js";import"../chunks/constants2.js";import"../chunks/setBillingAddress.js";import"../chunks/setShippingAddress.js";import"../chunks/constants.js";import"../chunks/setPaymentMethod.js";import"../chunks/constants3.js";const S=J(null),ke=o=>r.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},r.createElement("g",{clipPath:"url(#clip0_102_196)"},r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),r.createElement("defs",null,r.createElement("clipPath",{id:"clip0_102_196"},r.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),B=o=>r.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},r.createElement("g",{clipPath:"url(#clip0_4797_15331)"},r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.25 20.91L1.5 17.55V6.51996L10.25 9.92996V20.91Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.24023 4.64001L14.9902 8.06001V11.42",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19 13.31L15.5 19.37H22.5L19 13.31Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19.0202 17.11H18.9802L18.9502 15.56H19.0502L19.0202 17.11ZM18.9602 18.29V18.06H19.0502V18.29H18.9602Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19 12.16V6.51996L10.25 9.92996V20.91L14.27 19.37L14.4 19.32",stroke:"currentColor",strokeLinejoin:"round"}),r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.51999L10.25 3.04999L19 6.51999L10.25 9.92999L1.5 6.51999Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),r.createElement("defs",null,r.createElement("clipPath",{id:"clip0_4797_15331"},r.createElement("rect",{width:22,height:18.86,fill:"white",transform:"translate(1 2.54999)"})))),ge=({className:o,title:l,routeHome:e,...u})=>{const c=g({Title:"Checkout.EmptyCart.title",Button:"Checkout.EmptyCart.button"});return t(v,{...u,"data-testid":"checkout-empty-cart",className:m(["checkout-empty-cart",o]),heading:l??c.Title,icon:t(E,{className:m(["checkout-empty-cart__icon"]),source:ke}),action:e!=null&&e()?t(C,{className:"checkout-empty-cart__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:c.Button},"routeHome"):void 0})},Se=({className:o,icon:l,routeCart:e,...u})=>{const c=g({Title:"Checkout.OutOfStock.title",Message:"Checkout.OutOfStock.message"});return L("div",{...u,className:m(["checkout-out-of-stock",o]),"data-testid":"checkout-out-of-stock",children:[t(v,{heading:c.Title,message:t("p",{children:c.Message}),icon:t(E,{source:l??B,className:m(["checkout-out-of-stock__icon"])})}),(e==null?void 0:e())&&t(C,{className:"checkout-out-of-stock__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:t(ne,{id:"Checkout.OutOfStock.button"})},"routeCart")]})},ve=({className:o,errorMessage:l,contactSupport:e,...u})=>{const{onClick:c}=u,s=g({Title:"Checkout.ServerError.title",Message:"Checkout.ServerError.message",ContactSupport:"Checkout.ServerError.contactSupport",Button:"Checkout.ServerError.button"});return t(v,{"aria-invalid":"true","aria-describedby":"checkout-server-error__message","aria-live":"polite",className:m(["checkout-server-error",o]),"data-testid":"checkout-server-error",heading:l??s.Title,message:L("p",{id:m(["checkout-server-error__message"]),children:[s.Message,t("br",{}),t(ie,{id:"",children:e??s.ContactSupport})]}),icon:t(E,{className:m(["checkout-server-error__icon"]),source:B}),action:t(C,{className:m(["checkout-server-error__button"]),onClick:c,children:s.Button})})},nt="OUT_OF_STOCK";function Ee(){te(()=>{const o=T.on("authenticated",l=>{S.value=l},{eager:!0});return()=>{o==null||o.off()}},[])}const it=o=>{const{className:l,slots:e,routeHome:u,routeCart:c,preselectedCartData:s,...P}=o,[O,y]=k(""),[b,x]=k(),[N,j]=k(!1),[F,V]=k(!1),{data:i}=p.value,A=i!==void 0,h=(i==null?void 0:i.virtual)||!1,I=O!=="",M=i==null?void 0:i.items,U=M!==void 0&&M.length>0,Z=A&&!U,H=g({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),z=re(async()=>{i&&(await X(i.id),p.value={pending:!1},j(!0))},[i]),K=n=>{x(()=>n)},R=async()=>{y(""),i&&await w(i.id)},_=n=>{y(n instanceof TypeError||n instanceof W?H.CheckoutUnexpectedError:n.message)},w=async n=>{const a=await Y(n);a!=null&&a.virtual&&(ee.value={checked:!1,setByUser:!1})},$=async n=>{const a=await D(n);V(a===Q.OutOfStock)};if(Ee(),oe(()=>{const n=T.on("cart/data",a=>{if(!S.value){if(a&&a.id){p.value={...p.value,pending:!0},w(a.id),$(a.id);return}p.value={pending:!1,data:null}}},{eager:!0});return()=>{n==null||n.off()}},[]),S.value===null||N)return null;if(Z)return t(ge,{routeHome:u});if(I)return t(ve,{errorMessage:O,onClick:R});const q=()=>F?t(f.Main,{outOfStock:t(Se,{routeCart:c})}):t(f.Main,{sections:{billingAddress:t(d,{name:"BillingForm",slot:e==null?void 0:e.BillingForm,children:t(de,{})}),billToShippingAddress:h?void 0:t(d,{name:"BillToShipping",slot:e==null?void 0:e.BillToShipping,children:t(le,{})}),login:t(d,{name:"Login",slot:e==null?void 0:e.Login,children:t(ce,{})}),paymentMethods:t(ue,{isShippingInfoRequired:!h,onPlaceOrder:K,handleServerError:_,paymentMethodsSlot:e==null?void 0:e.PaymentMethods}),placeOrder:t(pe,{onClick:b??z,handleServerError:_}),shippingAddress:h?void 0:t(d,{name:"ShippingForm",slot:e==null?void 0:e.ShippingForm,children:t(ae,{preselectedFields:s==null?void 0:s.address})}),shippingMethods:h?void 0:t(d,{name:"ShippingMethods",slot:e==null?void 0:e.ShippingMethods,children:t(se,{preSelectedMethod:s==null?void 0:s.shippingMethod})})}}),G=()=>t(f.Aside,{sections:{cartSummary:t(d,{name:"CartSummary",slot:e==null?void 0:e.CartSummary,children:t(fe,{routeCart:c})}),orderSummary:t(d,{name:"OrderSummary",slot:e==null?void 0:e.OrderSummary,children:t(me,{})})}});return L(f,{className:l,banner:t(he,{}),...P,children:[G(),q()]})};export{it as Checkout,nt as OUT_OF_STOCK,it as default};
//# sourceMappingURL=Checkout.js.map
