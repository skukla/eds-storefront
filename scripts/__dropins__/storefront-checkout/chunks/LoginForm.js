import"./countries.js";import"@dropins/tools/event-bus.js";import{e as y}from"./dispatchApiCall.js";import{i as M,s as T}from"./setGuestEmailOnCart.js";import{Field as A,Input as O}from"@dropins/tools/components.js";import{jsx as r,jsxs as d}from"@dropins/tools/preact-jsx-runtime.js";import{H as z}from"./CartSummaryItem.js";import{useState as g,useEffect as B}from"@dropins/tools/preact-hooks.js";import{classes as k}from"@dropins/tools/lib.js";/* empty css                     */import{useText as F,Text as I}from"@dropins/tools/i18n.js";import{L as S}from"./constants2.js";const j=({value:s,error:l,hint:c,onChange:e,onBlur:o,onInvalid:m})=>{const a=F({LoginFormLabel:"Checkout.LoginForm.ariaLabel",LoginFormFloatingLabel:"Checkout.LoginForm.floatingLabel",LoginFormPlaceholder:"Checkout.LoginForm.placeholder"});return r(A,{size:"medium",error:l,hint:c,children:r(O,{id:"customer-email",name:"userName",type:"email",value:s,autocomplete:"email",placeholder:a.LoginFormPlaceholder,floatingLabel:a.LoginFormFloatingLabel,onChange:e,onBlur:o,onInvalid:m,required:!0,"aria-label":a.LoginFormLabel,"aria-required":!0})})},q=()=>d("p",{className:"checkout-login-form__signIn",children:[r(I,{id:"Checkout.LoginForm.account"}),r("a",{className:"checkout-login-form__link",href:"#",target:"_blank",rel:"noreferrer",children:r(I,{id:"Checkout.LoginForm.signIn"})})]}),G=({name:s,className:l,currentEmail:c,hint:e,error:o=null,onEmailChange:m,onEmailBlur:a,onEmailInvalid:h,...E})=>{const t=F({Title:"Checkout.LoginForm.title"});return d("div",{...E,className:k(["checkout-login-form",l]),children:[d("div",{className:"checkout-login-form__heading",children:[r(z,{level:2,className:"checkout-login-form__title",children:t.Title}),r(q,{})]}),r("div",{className:"checkout-login-form__content",children:d("form",{className:k(["dropin-login-form__form",l]),name:s,noValidate:!0,children:[r("button",{type:"submit",disabled:!0,style:"display: none","aria-hidden":"true"}),r(j,{value:c||void 0,error:o||"",hint:e,onChange:m,onBlur:a,onInvalid:h})]})})]})},H=1e3,Z=({className:s,email:l=null,...c})=>{const e=F({LoginFormInvalidEmailError:"Checkout.LoginForm.invalidEmailError",LoginFormMissingEmailError:"Checkout.LoginForm.missingEmailError",LoginFormEmailExists:"Checkout.LoginForm.emailExists"}),{data:o}=y.value,m=(o==null?void 0:o.id)||"",a=!!o,[h,E]=g(!1),[t,p]=g(l),[L,u]=g(),[_,f]=g(!0),v=i=>i.valid?null:i.valueMissing?e.LoginFormMissingEmailError:e.LoginFormInvalidEmailError,b=i=>{const{value:n}=i.target;p(n),u(null),f(!0)},C=i=>{const{validity:n}=i.target;u(v(n))},N=i=>{const{validity:n}=i.target;u(v(n))};return!h&&a&&(E(!0),p((o==null?void 0:o.email)||l)),B(()=>{if(!t||L||(o==null?void 0:o.email)===t)return;const i=setTimeout(()=>{M(t).then(n=>{f(n),T({cartId:m,email:t}).catch(x=>{console.log("set email failed",x)})}).catch(n=>{console.log(n),u(e.LoginFormInvalidEmailError),f(!0)})},H);return()=>{i&&clearTimeout(i)}},[t,L,e.LoginFormInvalidEmailError,o==null?void 0:o.email,m]),r(G,{className:s,currentEmail:t,error:L,hint:_?"":e.LoginFormEmailExists,name:S,onEmailBlur:C,onEmailChange:b,onEmailInvalid:N,...c})};export{Z as L};
//# sourceMappingURL=LoginForm.js.map
