import{createContext as D,Component as re,options as k,isValidElement as se}from"@dropins/tools/preact.js";import{useContext as E,useMemo as $,useState as R,useEffect as M}from"@dropins/tools/preact-hooks.js";import{jsx as I}from"@dropins/tools/preact-jsx-runtime.js";import{FetchGraphQL as oe}from"@dropins/tools/fetch-graphql.js";import{events as ne}from"@dropins/tools/event-bus.js";const H=D({});function Ne({children:e,services:t}){return I(H.Provider,{value:t,children:e})}function Pe(){const e=E(H);if(e!==void 0)return e;throw new Error("useServices must be used within a ServicesProvider")}const{setEndpoint:Ue,setFetchGraphQlHeader:Le,removeFetchGraphQlHeader:qe,setFetchGraphQlHeaders:ke,fetchGraphQl:F,getConfig:$e}=new oe().getMethods();var f=(e=>(e.Boolean="BOOLEAN",e.Date="DATE",e.Datetime="DATETIME",e.File="FILE",e.Gallery="GALLERY",e.Hidden="HIDDEN",e.Image="IMAGE",e.MediaImage="MEDIA_IMAGE",e.Multiline="MULTILINE",e.Multiselect="MULTISELECT",e.Price="PRICE",e.Select="SELECT",e.Text="TEXT",e.Textarea="TEXTAREA",e.Undefined="UNDEFINED",e.Weight="WEIGHT",e))(f||{}),ae=(e=>(e.InStock="IN_STOCK",e.OutOfStock="OUT_OF_STOCK",e))(ae||{}),S=(e=>(e.DisplayExcludingTax="DISPLAY_EXCLUDING_TAX",e.DisplayIncludingTax="DISPLAY_INCLUDING_TAX",e.DisplayTypeBoth="DISPLAY_TYPE_BOTH",e))(S||{}),le=(e=>(e.DateRangeMax="DATE_RANGE_MAX",e.DateRangeMin="DATE_RANGE_MIN",e.FileExtensions="FILE_EXTENSIONS",e.InputValidation="INPUT_VALIDATION",e.MaxFileSize="MAX_FILE_SIZE",e.MaxImageHeight="MAX_IMAGE_HEIGHT",e.MaxImageWidth="MAX_IMAGE_WIDTH",e.MaxTextLength="MAX_TEXT_LENGTH",e.MinTextLength="MIN_TEXT_LENGTH",e))(le||{}),d=(e=>(e[e.ExcludingTax=1]="ExcludingTax",e[e.IncludingTax=2]="IncludingTax",e[e.IncludingAndExcludingTax=3]="IncludingAndExcludingTax",e))(d||{}),x=(e=>(e[e.Rows=0]="Rows",e[e.Quantity=1]="Quantity",e))(x||{});const ue=e=>e==null;function fe(e){return e===0?x.Rows:x.Quantity}function w(e){return e===1?d.ExcludingTax:e===2?d.IncludingTax:e===3?d.IncludingAndExcludingTax:d.ExcludingTax}function de(e){switch(e){case S.DisplayExcludingTax:return d.ExcludingTax;case S.DisplayIncludingTax:return d.IncludingTax;case S.DisplayTypeBoth:return d.IncludingAndExcludingTax}}function ce(e){if(!e)return l;const{default_country:t,countries_with_required_region:i,display_state_if_optional:r,optional_zip_countries:n,is_guest_checkout_enabled:s,is_one_page_checkout_enabled:a,shopping_cart_display_price:c,shopping_cart_display_shipping:p,shopping_cart_display_subtotal:h,shopping_cart_display_tax_gift_wrapping:g,shopping_cart_display_grand_total:V,shopping_cart_display_full_summary:ee,shopping_cart_display_zero_tax:te,max_items_in_order_summary:ie,cart_summary_display_quantity:q}=e;return{defaultCountry:t||l.defaultCountry,countriesWithRequiredRegion:(i==null?void 0:i.split(","))||l.countriesWithRequiredRegion,displayStateIfOptional:r||l.displayStateIfOptional,countriesWithOptionalZipCode:(n==null?void 0:n.split(","))||l.countriesWithOptionalZipCode,isGuestCheckoutEnabled:s||l.isGuestCheckoutEnabled,isOnePageCheckoutEnabled:a||l.isOnePageCheckoutEnabled,taxCartDisplay:{shoppingCartDisplayPrice:c?w(c):l.taxCartDisplay.shoppingCartDisplayPrice,shoppingCartDisplayShipping:p?w(p):l.taxCartDisplay.shoppingCartDisplayShipping,shoppingCartDisplaySubtotal:h?w(h):l.taxCartDisplay.shoppingCartDisplaySubtotal,shoppingCartDisplayGiftWrapping:g?de(g):l.taxCartDisplay.shoppingCartDisplayGiftWrapping,shoppingCartDisplayGrandTotal:V||l.taxCartDisplay.shoppingCartDisplayGrandTotal,shoppingCartDisplayFullSummary:ee||l.taxCartDisplay.shoppingCartDisplayFullSummary,shoppingCartDisplayZeroTax:te||l.taxCartDisplay.shoppingCartDisplayZeroTax},cartSummaryMaxItems:ie||l.cartSummaryMaxItems,cartSummaryTotalDisplay:ue(q)?l.cartSummaryTotalDisplay:fe(q)}}const pe=e=>{if(e)return e.filter(t=>!!t).filter(t=>{const{two_letter_abbreviation:i,full_name_locale:r}=t;return!!i&&!!r}).map(t=>{const{two_letter_abbreviation:i,full_name_locale:r}=t;return{value:i,label:r}})},he=e=>e?e.filter(Boolean).filter(i=>(i==null?void 0:i.label)&&(i==null?void 0:i.value)).map(i=>({text:i.label,value:i.value})):[],ve=e=>e?e.filter(Boolean).filter(t=>(t==null?void 0:t.name)&&(t==null?void 0:t.value)):[],_e=e=>e?e.filter(Boolean).map(i=>({code:i.code,defaultValue:i.default_value||void 0,frontendInput:i.frontend_input||void 0,isDisabled:!1,isRequired:i.is_required,label:i.label||void 0,multilineCount:i.multiline_count||void 0,options:he(i.options),sortOrder:i.sort_order||void 0,validateRules:ve(i.validate_rules)})):[],ye=`
  query fetchAddressFormFields {
    attributesForm(formCode: "customer_register_address") {
      items {
        frontend_input
        code
        label
        default_value
        is_required
        options {
          label
          value
          is_default
        }
        ... on CustomerAttributeMetadata {
          multiline_count
          sort_order
          validate_rules {
            name
            value
          }
        }
      }
      errors {
        message
        type
      }
    }
  }
`,G=e=>{if(!(!e||e.length===0))throw Error(e.map(t=>t.message).join(" "))},N=e=>{throw e instanceof DOMException&&e.name==="AbortError"||ne.emit("error",{source:"checkout",type:"network",error:e}),e},ge=async()=>F(ye,{method:"GET",cache:"no-cache"}).then(({data:e,errors:t})=>(G(t),_e(e.attributesForm.items))).catch(N),He=[{frontendInput:f.Text,code:"firstname",label:"First Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:10},{frontendInput:f.Text,code:"lastname",label:"Last Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:20},{frontendInput:f.Text,code:"company",label:"Company",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:30},{frontendInput:f.Multiline,code:"street",label:"Street Address",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:40},{frontendInput:f.Text,code:"city",label:"City",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:50},{frontendInput:f.Select,code:"country_id",label:"Country",isRequired:!0,isDisabled:!1,options:[{text:"United States",value:"US"},{text:"Spain",value:"ES"},{text:"France",value:"FR"}],validateRules:[],sortOrder:60},{frontendInput:f.Text,code:"region",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:70},{frontendInput:f.Hidden,code:"region_id",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:80},{frontendInput:f.Text,code:"postcode",label:"Zip/Postal Code",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:90},{frontendInput:f.Text,code:"telephone",label:"Phone Number",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:100},{frontendInput:f.Text,code:"vat_id",label:"VAT Number",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:110}];var xe=Symbol.for("preact-signals");function P(){if(v>1)v--;else{for(var e,t=!1;m!==void 0;){var i=m;for(m=void 0,A++;i!==void 0;){var r=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&W(i))try{i.c()}catch(n){t||(e=n,t=!0)}i=r}}if(A=0,v--,t)throw e}}var o=void 0,m=void 0,v=0,A=0,T=0;function Q(e){if(o!==void 0){var t=e.n;if(t===void 0||t.t!==o)return t={i:0,S:e,p:o.s,n:void 0,t:o,e:void 0,x:void 0,r:t},o.s!==void 0&&(o.s.n=t),o.s=t,e.n=t,32&o.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=o.s,t.n=void 0,o.s.n=t,o.s=t),t}}function u(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}u.prototype.brand=xe;u.prototype.h=function(){return!0};u.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};u.prototype.U=function(e){if(this.t!==void 0){var t=e.e,i=e.x;t!==void 0&&(t.x=i,e.e=void 0),i!==void 0&&(i.e=t,e.x=void 0),e===this.t&&(this.t=i)}};u.prototype.subscribe=function(e){var t=this;return L(function(){var i=t.value,r=o;o=void 0;try{e(i)}finally{o=r}})};u.prototype.valueOf=function(){return this.value};u.prototype.toString=function(){return this.value+""};u.prototype.toJSON=function(){return this.value};u.prototype.peek=function(){var e=o;o=void 0;try{return this.value}finally{o=e}};Object.defineProperty(u.prototype,"value",{get:function(){var e=Q(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(A>100)throw new Error("Cycle detected");this.v=e,this.i++,T++,v++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{P()}}}});function X(e){return new u(e)}function W(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function B(e){for(var t=e.s;t!==void 0;t=t.n){var i=t.S.n;if(i!==void 0&&(t.r=i),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Z(e){for(var t=e.s,i=void 0;t!==void 0;){var r=t.p;t.i===-1?(t.S.U(t),r!==void 0&&(r.n=t.n),t.n!==void 0&&(t.n.p=r)):i=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=r}e.s=i}function _(e){u.call(this,void 0),this.x=e,this.s=void 0,this.g=T-1,this.f=4}(_.prototype=new u).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===T))return!0;if(this.g=T,this.f|=1,this.i>0&&!W(this))return this.f&=-2,!0;var e=o;try{B(this),o=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return o=e,Z(this),this.f&=-2,!0};_.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}u.prototype.S.call(this,e)};_.prototype.U=function(e){if(this.t!==void 0&&(u.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};_.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(_.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=Q(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function me(e){return new _(e)}function j(e){var t=e.u;if(e.u=void 0,typeof t=="function"){v++;var i=o;o=void 0;try{t()}catch(r){throw e.f&=-2,e.f|=8,U(e),r}finally{o=i,P()}}}function U(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,j(e)}function Ce(e){if(o!==this)throw new Error("Out-of-order effect");Z(this),o=e,this.f&=-2,8&this.f&&U(this),P()}function C(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}C.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};C.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,j(this),B(this),v++;var e=o;return o=this,Ce.bind(this,e)};C.prototype.N=function(){2&this.f||(this.f|=2,this.o=m,m=this)};C.prototype.d=function(){this.f|=8,1&this.f||U(this)};function L(e){var t=new C(e);try{t.c()}catch(i){throw t.d(),i}return t.d.bind(t)}var O;function y(e,t){k[e]=t.bind(null,k[e]||function(){})}function b(e){O&&O(),O=e&&e.S()}function Y(e){var t=this,i=e.data,r=Te(i);r.value=i;var n=$(function(){for(var s=t.__v;s=s.__;)if(s.__c){s.__c.__$f|=4;break}return t.__$u.c=function(){var a;!se(n.peek())&&((a=t.base)==null?void 0:a.nodeType)===3?t.base.data=n.peek():(t.__$f|=1,t.setState({}))},me(function(){var a=r.value.value;return a===0?0:a===!0?"":a||""})},[]);return n.value}Y.displayName="_st";Object.defineProperties(u.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Y},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});y("__b",function(e,t){if(typeof t.type=="string"){var i,r=t.props;for(var n in r)if(n!=="children"){var s=r[n];s instanceof u&&(i||(t.__np=i={}),i[n]=s,r[n]=s.peek())}}e(t)});y("__r",function(e,t){b();var i,r=t.__c;r&&(r.__$f&=-2,(i=r.__$u)===void 0&&(r.__$u=i=function(n){var s;return L(function(){s=this}),s.c=function(){r.__$f|=1,r.setState({})},s}())),b(i),e(t)});y("__e",function(e,t,i,r){b(),e(t,i,r)});y("diffed",function(e,t){b();var i;if(typeof t.type=="string"&&(i=t.__e)){var r=t.__np,n=t.props;if(r){var s=i.U;if(s)for(var a in s){var c=s[a];c!==void 0&&!(a in r)&&(c.d(),s[a]=void 0)}else i.U=s={};for(var p in r){var h=s[p],g=r[p];h===void 0?(h=Se(i,p,g,n),s[p]=h):h.o(g,n)}}}e(t)});function Se(e,t,i,r){var n=t in e&&e.ownerSVGElement===void 0,s=X(i);return{o:function(a,c){s.value=a,r=c},d:L(function(){var a=s.value.value;r[t]!==a&&(r[t]=a,n?e[t]=a:a?e.setAttribute(t,a):e.removeAttribute(t))})}}y("unmount",function(e,t){if(typeof t.type=="string"){var i=t.__e;if(i){var r=i.U;if(r){i.U=void 0;for(var n in r){var s=r[n];s&&s.d()}}}}else{var a=t.__c;if(a){var c=a.__$u;c&&(a.__$u=void 0,c.d())}}e(t)});y("__h",function(e,t,i,r){(r<3||r===9)&&(t.__$f|=2),e(t,i,r)});re.prototype.shouldComponentUpdate=function(e,t){var i=this.__$u;if(!(i&&i.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var r in t)return!0;for(var n in e)if(n!=="__source"&&e[n]!==this.props[n])return!0;for(var s in this.props)if(!(s in e))return!0;return!1};function Te(e){return $(function(){return X(e)},[])}const be=`
  query getStoreConfig {
    storeConfig {
      cart_summary_display_quantity
      countries_with_required_region
      default_country
      display_state_if_optional
      is_guest_checkout_enabled
      is_one_page_checkout_enabled
      locale
      max_items_in_order_summary
      optional_zip_countries
      shopping_cart_display_full_summary
      shopping_cart_display_grand_total
      shopping_cart_display_price
      shopping_cart_display_shipping
      shopping_cart_display_subtotal
      shopping_cart_display_tax_gift_wrapping
      shopping_cart_display_zero_tax
      store_code
    }
  }
`,De=async()=>F(be,{method:"GET",cache:"no-cache"}).then(({data:e,errors:t})=>(G(t),ce(e==null?void 0:e.storeConfig))).catch(N),Ee=`
query getCountries {
    countries {
      two_letter_abbreviation
      full_name_locale
    }
}`,Ie=async()=>F(Ee,{method:"GET",cache:"no-cache"}).then(({data:e,errors:t})=>(t&&G(t),pe(e.countries))).catch(N),we="US",Oe=10,l={defaultCountry:we,countriesWithRequiredRegion:[],displayStateIfOptional:!1,countriesWithOptionalZipCode:[],isGuestCheckoutEnabled:!1,isOnePageCheckoutEnabled:!1,taxCartDisplay:{shoppingCartDisplayPrice:d.ExcludingTax,shoppingCartDisplayShipping:d.ExcludingTax,shoppingCartDisplaySubtotal:d.ExcludingTax,shoppingCartDisplayGiftWrapping:d.ExcludingTax,shoppingCartDisplayGrandTotal:!1,shoppingCartDisplayFullSummary:!1,shoppingCartDisplayZeroTax:!1},cartSummaryMaxItems:Oe,cartSummaryTotalDisplay:x.Quantity},z=D(void 0),Qe=({children:e})=>{const[t,i]=R();return M(()=>{De().then(r=>{i(r)}).catch(()=>{console.error("Failed to fetch store config"),i(l)})},[]),I(z.Provider,{value:{config:t},children:e})};function Xe(){const e=E(z);if(e!==void 0)return e;throw new Error("useStore must be used within a StoreProvider")}const K=D(void 0);function We({children:e}){const[t,i]=R({});return M(()=>{ge().then(r=>i({fields:r}))},[]),I(K.Provider,{value:t,children:e})}function Be(){const e=E(K);if(e!==void 0)return e;throw new Error("useAddressFormFields must be used within an AddressFormFieldsProvider")}const J=D(void 0);function Ze({children:e}){const[t,i]=R({});return M(()=>{Ie().then(r=>i({countries:r}))},[]),I(J.Provider,{value:t,children:e})}function je(){const e=E(J);if(e!==void 0)return e;throw new Error("useCountries must be used within a CountriesProvider")}export{We as A,Ze as C,ae as P,Ne as S,x as T,le as V,Le as a,ke as b,ge as c,He as d,De as e,F as f,$e as g,Ie as h,X as i,Xe as j,N as k,G as l,Qe as m,ue as n,d as o,f as p,je as q,qe as r,Ue as s,Pe as t,Be as u};
//# sourceMappingURL=countries.js.map
