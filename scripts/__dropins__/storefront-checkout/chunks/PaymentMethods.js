import"./countries.js";import"@dropins/tools/event-bus.js";import{e as I}from"./dispatchApiCall.js";import{s as O}from"./setPaymentMethod.js";import{H as U}from"./CartSummaryItem.js";import"@dropins/tools/preact-hooks.js";import{classes as k,Slot as x}from"@dropins/tools/lib.js";import{IllustratedMessage as $,Icon as q,ProgressSpinner as Z,Skeleton as F,SkeletonRow as P,RadioButton as G}from"@dropins/tools/components.js";/* empty css                     */import{jsx as e,jsxs as f,Fragment as J}from"@dropins/tools/preact-jsx-runtime.js";import*as v from"@dropins/tools/preact-compat.js";import{useRef as K,useState as S,useCallback as T,useEffect as N}from"@dropins/tools/preact-compat.js";import{useText as Q}from"@dropins/tools/i18n.js";const X=t=>v.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},v.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),v.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),v.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),Y=({code:t,isLoading:n,isSelected:c,onChange:s,title:o})=>e(te,{className:"checkout-payment-methods__method",label:o,name:"payment-method",value:t,selected:c,onChange:s,radioButtonProps:{"aria-busy":n}}),D=({className:t,paymentMethodContent:n,isLoading:c,onChange:s=()=>{},options:o,selection:u})=>{const d=Q({Title:"Checkout.PaymentMethods.title",EmptyState:"Checkout.PaymentMethods.emptyState"});return o===void 0?e(ee,{}):f("div",{className:k(["checkout-payment-methods",t]),children:[e(U,{level:2,className:"checkout-payment-methods__title",children:d.Title}),!c&&o.length===0&&e($,{icon:e(q,{source:X}),message:e("p",{children:d.EmptyState})}),f("div",{className:k(["checkout-payment-methods__wrapper"]),children:[c&&e(Z,{className:"checkout-payment-methods__spinner"}),e("div",{className:k(["checkout-payment-methods__methods",["checkout-payment-methods--loading",c],["checkout-payment-methods--full-width",o.length%2!==0]]),children:o==null?void 0:o.map(l=>e(Y,{code:l.code,onChange:s,isSelected:l.code===u,title:l.title},l.code))}),n&&e("div",{className:"checkout-payment-methods__content",children:n})]})]})},ee=()=>f(F,{"data-testid":"payment-methods-skeleton",children:[e(P,{variant:"heading",size:"medium"}),e(P,{variant:"empty",size:"medium"}),e(P,{size:"xlarge",fullWidth:!0}),e(P,{size:"xlarge",fullWidth:!0})]}),te=({label:t,name:n,value:c,icon:s,selected:o,onChange:u,className:d,children:l,radioButtonProps:y,...p})=>e("div",{className:k(["checkout-toggle-button",d,["checkout-toggle-button__selected",o]]),...p,children:f("label",{className:"checkout-toggle-button__actionButton",children:[e(G,{...y,label:"",name:n,value:c,checked:o,onChange:()=>u(c),"aria-label":t,className:k([d,"checkout-toggle-button__radioButton"])}),f("div",{className:"checkout-toggle-button__content",children:[s&&e(s.type,{...s==null?void 0:s.props,className:"checkout-toggle-button__icon"}),t]})]})}),L={free:{render:t=>{const n=document.createElement("div");n.innerText="",t.replaceHTML(n)}},checkmo:{render:t=>{const n=document.createElement("div");n.innerText="",t.replaceHTML(n)}}};function ne(t){var E;const{onPlaceOrder:n,handleServerError:c,paymentMethodsSlot:s,isShippingInfoRequired:o}=t,u=K(),[d,l]=S(),[y,p]=S(),[g,W]=S(L),[_,B]=S(!0),{data:a}=I.value,C=(a==null?void 0:a.id)??"",b=!!a,w=!!((E=a==null?void 0:a.shippingAddresses)!=null&&E[0]),i=a==null?void 0:a.availablePaymentMethods,m=a==null?void 0:a.selectedPaymentMethod,M=T(async r=>{try{if(l(r),!w&&o)return;const h=r;if(h===u.current)return;u.current=h,await O({cartId:C,paymentMethod:r})}catch(h){console.error("setting payment method failed:",h)}},[C,w,o]);N(()=>{b&&(m!=null&&m.code?(i==null?void 0:i.some(h=>h.code===m.code))?l(m.code):i!=null&&i.length?M(i[0].code):l(void 0):i[0]&&M(y||i[0].code))},[i,b,m,M,y]);const R=async r=>{await M(r),m!=null&&m.code||p(r)},V=T((r,h)=>{if(!r){console.warn("Payment method handler is ignored because it has no code");return}if(!h){console.warn("Payment method handler is ignored because it is empty");return}W(z=>({...z,[r]:h}))},[]),j=s?e(x,{name:"PaymentMethods",slot:s,context:{addPaymentMethodHandler:V,replaceHTML(r){this.replaceWith(r),B(!1)}}}):null,H=d?g[d]:null,A=H?e(x,{name:"PaymentMethodContent",slot:H.render,context:{cartId:C,onPlaceOrder:n,handleServerError:c,replaceHTML(r){this.replaceWith(r)}}},H):void 0;return N(()=>{!_&&g!=L&&console.warn("Payment method handlers you have added are ignored because the default content has been replaced")},[_,g]),{availablePaymentMethods:i,selectedPaymentMethod:d,onPaymentMethodChange:R,paymentMethodContent:A,mainSlotContent:j,isDefaultContentUsed:_}}const ye=t=>{const{onPlaceOrder:n,handleServerError:c,paymentMethodsSlot:s,isShippingInfoRequired:o=!0}=t,{availablePaymentMethods:u,selectedPaymentMethod:d,onPaymentMethodChange:l,paymentMethodContent:y,mainSlotContent:p,isDefaultContentUsed:g}=ne({onPlaceOrder:n,handleServerError:c,paymentMethodsSlot:s,isShippingInfoRequired:o});return f(J,{children:[p&&e(p.type,{ref:p.ref,...p.props}),g&&e(D,{options:u,selection:d,onChange:l,paymentMethodContent:y,isLoading:I.value.pending})]})};export{ye as P};
//# sourceMappingURL=PaymentMethods.js.map
